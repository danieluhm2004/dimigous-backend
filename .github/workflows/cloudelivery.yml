name: Release to Cloudelivery
on: 
  push:
    branches:
      - release

jobs:
  build:
    runs-on: [self-hosted, ubuntu-18.04]
    steps:
      - name: Checkout source code.
        uses: actions/checkout@master
        
      - name: Cache node modules.
        uses: actions/cache@v1
        with:
          path: node_modules
          key: ${{ runner.OS }}-build-${{ hashFiles('**/yarn.lock') }}
          restore-keys: |
            ${{ runner.OS }}-build-
            ${{ runner.OS }}-
            
      - name: Docker Image Build.
        uses: mr-smithers-excellent/docker-build-push@v2
        with:
          image: docker.clou.delivery/dimigo-asked
          tag: latest
          registry: docker.clou.delivery
          dockerfile: Dockerfile
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}
